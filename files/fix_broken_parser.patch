
# HG changeset patch
# User Phil Thompson <phil@riverbankcomputing.com>
# Date 1650982639 -3600
# Node ID a069205270ea3cb7b4f5703c1a9ffd68aeed67a6
# Parent  0da96769835fd831163c41694d8d6267f7b8cda4
More minor bug fixes.

diff -r 0da96769835f -r a069205270ea sipbuild/generator/parser/instantiations.py
--- a/sipbuild/generator/parser/instantiations.py	Mon Apr 25 17:56:27 2022 +0100
+++ b/sipbuild/generator/parser/instantiations.py	Tue Apr 26 15:17:19 2022 +0100
@@ -183,7 +183,7 @@
         proto_template = proto_arg.definition
         i_template = copy(proto_template)
         i_template.types = _instantiate_signature(proto_template.types,
-                proto_class, template, i_class, expansions, pm)
+                proto_class, tmpl_names, template, i_class, expansions, pm)
         i_arg.definition = i_template
 
     # Handle any default value.
@@ -375,11 +375,10 @@
             if kw_args is KwArgs.ALL or (kw_args is KwArgs.OPTIONAL and i_arg.default_value is not None):
                 i_arg.name.used = True
 
-    if proto_signature.result.type is not ArgumentType.NONE:
+    if proto_signature.result is not None:
         i_signature.result = _instantiate_argument(proto_signature.result,
                 proto_class, tmpl_names, template, i_class, expansions, pm)
 
-    assert not isinstance(i_signature.result, list)
     return i_signature
 
 
diff -r 0da96769835f -r a069205270ea sipbuild/generator/specification.py
--- a/sipbuild/generator/specification.py	Mon Apr 25 17:56:27 2022 +0100
+++ b/sipbuild/generator/specification.py	Tue Apr 26 15:17:19 2022 +0100
@@ -1740,17 +1740,17 @@
     raise_code: CodeBlock
 
     # The base exception if it is a builtin.
-    builtin_base_exception: Optional[str]
+    builtin_base_exception: Optional[str] = None
 
     # The class that implements the exception (if the exception is not a Python
     # exception).
-    class_exception: Optional[WrappedClass]
+    class_exception: Optional[WrappedClass] = None
 
     # The base exception if it is defined in the specification.
-    defined_base_exception: Optional['WrappedException']
+    defined_base_exception: Optional['WrappedException'] = None
 
     # The Python name.
-    py_name: Optional[str]
+    py_name: Optional[str] = None
 
 
 @dataclass

